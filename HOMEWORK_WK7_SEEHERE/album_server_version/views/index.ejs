<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
    <!--<form action="/upload" method="post" enctype="multipart/form-data">-->
      <!--<input type="file" name="singleFile" value="">-->
      <!--<input type="submit" value="submit">-->
    <!--</form>-->

    <div class="photos">
        <%list.forEach(imgname=>{ %>
          <img src="/img/<%=imgname%>" alt="photos">
        <%})%>
    </div>
    <script type="text/javascript">
      function createElement(htmltext){
        const div = document.createElement("div");
        div.innerHTML = htmltext;
        return div.firstElementChild;
      }

      const oInput = createElement(`
      <input type="file" style="display:none;">
      `);
      const oAnchor = createElement(`
      <a href="#"> add image </a>
      `);

      oAnchor.addEventListener("click", function(ev){
        oInput.click();
      });
      const photos = document.querySelector(".photos");

      oInput.addEventListener("click", function(ev){
        let file = event.target.files[0];

        var formdata = new FormData();
        formdata.append("myImg", file);
        upload(formdata);

        var reader = new FileReader();
        reader.onload = function(){
          var img = new Image();
          img.src = reader.result;
          photos.appendChild(img);
        }
        reader.readAsDataURL(file);
      });

      document.body.insertAdjacentElement("afterBegin", oAnchor);
      document.body.insertAdjacentElement("afterBegin", oInput)

      function upload(formdata){
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function(){
          if(xhr.status===400 && xhr.readyState===4){
            console.log(xhr.response);
          }
        }
        xhr.open("post", "/upload");
        xhr.send(formdata);
      }

    </script>
  </body>
</html>
